name: Deploy site to GitHub Pages
on:
  push:	
    branches:	
      - main

jobs:
  deploy:
    name: Deploy to GitHub Pages
    runs-on: ubuntu-latest    
    steps:
    
    - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
    - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
    - run: echo "üîé The name of github.ref is =${{ github.ref }} and github.repository is ${{ github.repository }}."
    - run: echo "Full path of repo - $GITHUB_SERVER_URL/$GITHUB_REPOSITORY"
    
    - name: Check out repository code
      uses: actions/checkout@master

    - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
    - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."

    - name: Move files into ./pages and check file
      run: mkdir /tmp/pages && cp --recursive ./src/static/* /tmp/pages && mv /tmp/pages ./pages

    - name: List files in the repository
      run: |
        ls ${{ github.workspace }} && tree ./pages

    # Push git subdirectory to gh-pages branch
    - name: Deploy
      uses: s0/git-publish-subdir-action@develop
      run: echo $REPO
      env:
        #REPO: git@github.com:zhekazuev/emonitoring-poczta-polska.git
        REPO: $GITHUB_SERVER_URL/$GITHUB_REPOSITORY
        BRANCH: gh-pages
        FOLDER: pages
        GITHUB_TOKEN: ${{ secrets.GHPAGES_TOKEN }}
        #SSH_PRIVATE_KEY: ${{ secrets.DEPLOY_PRIVATE_KEY }}

    - run: echo "üçè This job's status is ${{ job.status }}."
